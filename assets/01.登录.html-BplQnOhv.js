import{_ as o}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,d as i,o as s}from"./app-BVgJPCaJ.js";const t={};function a(r,e){return s(),n("div",null,[...e[0]||(e[0]=[i('<h1 id="一、身份认证与保持登录的三种模式" tabindex="-1"><a class="header-anchor" href="#一、身份认证与保持登录的三种模式"><span>一、身份认证与保持登录的三种模式</span></a></h1><h2 id="模式1-cookie-session-传统模式" tabindex="-1"><a class="header-anchor" href="#模式1-cookie-session-传统模式"><span>模式1：Cookie + Session（传统模式）</span></a></h2><p>暂时无法在南开飞书文档外展示此内容</p><p>具体流程：</p><ol><li>用户输入用户名密码提交登录</li><li>服务器验证通过，创建Session并存储用户信息</li><li>服务器响应：<code>Set-Cookie: JSESSIONID=abc123; HttpOnly</code></li><li>浏览器存储Cookie</li><li>后续请求自动携带：<code>Cookie: JSESSIONID=abc123</code></li><li>服务器通过SessionID查找Session，验证用户身份</li></ol><h2 id="模式2-token方案" tabindex="-1"><a class="header-anchor" href="#模式2-token方案"><span>模式2：Token方案</span></a></h2><p>暂时无法在南开飞书文档外展示此内容</p><p>Token流程细节（以JWT为例）：</p><ol><li>客户端提交认证信息</li><li>服务器验证成功后生成JWT：</li><li>Header.Payload.Signature</li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-"><span class="line"><span>{&quot;userId&quot;: &quot;123&quot;,&quot;username&quot;: &quot;john&quot;,&quot;exp&quot;: 1672531200, &quot;iat&quot;: 1672527600  // 签发时间}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol><li>服务器返回JWT给客户端</li><li>客户端存储JWT</li><li>后续请求手动添加到Header</li><li>服务器验证签名，解析Payload获取用户信息</li></ol><h2 id="模式3-session-token混合" tabindex="-1"><a class="header-anchor" href="#模式3-session-token混合"><span>模式3：Session + Token混合</span></a></h2><p>暂时无法在南开飞书文档外展示此内容</p><h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结"><span>小结</span></a></h2><p><strong>传统 Session vs Token-Session (现代无状态 Session)：</strong></p><ul><li><strong>传统 Session</strong>：客户端只持有一个 SessionID，服务器存储所有用户数据（如 <code>userId</code>、<code>name</code>、<code>permissions</code> 等）。</li><li><strong>Token-Session</strong>：客户端持有完整的 Token（包含用户数据），服务器不存储用户数据，只验证 Token 的签名。</li></ul><h4 id="_1-token-验证流程" tabindex="-1"><a class="header-anchor" href="#_1-token-验证流程"><span>1. <strong>Token 验证流程</strong></span></a></h4><ul><li><strong>Access Token 验证</strong>：服务器只验证 Token 的签名和过期时间，不查询数据库，除非使用了黑名单机制。</li><li><strong>Refresh Token 刷新</strong>：只有在 Access Token 过期或验证失败时，客户端才使用 Refresh Token 进行数据库查询以获取新的 Access Token。</li></ul><h4 id="_2-刷新逻辑" tabindex="-1"><a class="header-anchor" href="#_2-刷新逻辑"><span>2. <strong>刷新逻辑</strong></span></a></h4><ul><li><strong>返回错误而非延长 Token</strong>：服务器不会主动延长 Access Token 的有效期。若 Token 过期，服务器返回 <code>401</code> 错误，提示客户端使用 Refresh Token 刷新 Access Token。</li><li><strong>控制 Refresh Token 使用频率和撤销</strong>：这种设计有助于控制 Refresh Token 的使用频率和防止其滥用。</li></ul><h4 id="_3-refresh-token-刷新流程" tabindex="-1"><a class="header-anchor" href="#_3-refresh-token-刷新流程"><span>3. <strong>Refresh Token 刷新流程</strong></span></a></h4><ul><li><strong>客户端带 Refresh Token 请求刷新</strong>：通过 HttpOnly Cookie 自动携带 Refresh Token。</li><li><strong>服务器验证流程</strong>： <ul><li>计算 Token 哈希，查数据库或 Redis 对比存储记录。</li><li>检查 Token 是否被撤销（<code>revoked: true</code>）。</li><li>对比 Token 的过期时间（<code>expiresAt</code>）。</li><li>可选：检查刷新频率、设备指纹等。</li></ul></li><li><strong>验证通过后</strong>：服务器生成新的 Access Token 并可选择更新 Refresh Token（Token 轮换），同时更新最后使用时间。</li><li><strong>返回结果</strong>：返回新的 Access Token 或错误信息。</li></ul><h4 id="_4-安全设计原则" tabindex="-1"><a class="header-anchor" href="#_4-安全设计原则"><span>4. <strong>安全设计原则</strong></span></a></h4><ul><li><strong>Refresh Token 的严格验证</strong>：由于 Refresh Token 是长期凭证，必须对其进行严格管理和撤销控制。服务器存储的过期时间（<code>expiresAt</code>）是权威的，客户端 Cookie 的过期时间仅供参考。即便客户端 Cookie 仍有效，如果服务器端记录已过期或撤销，刷新请求将被拒绝。</li></ul>',24)])])}const p=o(t,[["render",a]]),d=JSON.parse(`{"path":"/projects/dianping/01.%E7%99%BB%E5%BD%95.html","title":"登录","lang":"zh-CN","frontmatter":{"title":"登录","icon":"sign-in-alt","article":false,"category":["项目","黑马点评"],"tag":["登录","身份验证"],"date":"2026-02-15T00:00:00.000Z","description":"一、身份认证与保持登录的三种模式 模式1：Cookie + Session（传统模式） 暂时无法在南开飞书文档外展示此内容 具体流程： 用户输入用户名密码提交登录 服务器验证通过，创建Session并存储用户信息 服务器响应：Set-Cookie: JSESSIONID=abc123; HttpOnly 浏览器存储Cookie 后续请求自动携带：Coo...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"WebPage\\",\\"name\\":\\"登录\\",\\"description\\":\\"一、身份认证与保持登录的三种模式 模式1：Cookie + Session（传统模式） 暂时无法在南开飞书文档外展示此内容 具体流程： 用户输入用户名密码提交登录 服务器验证通过，创建Session并存储用户信息 服务器响应：Set-Cookie: JSESSIONID=abc123; HttpOnly 浏览器存储Cookie 后续请求自动携带：Coo...\\"}"],["meta",{"property":"og:url","content":"https://mister-hope.github.io/blog/projects/dianping/01.%E7%99%BB%E5%BD%95.html"}],["meta",{"property":"og:site_name","content":"jiwang's blog"}],["meta",{"property":"og:title","content":"登录"}],["meta",{"property":"og:description","content":"一、身份认证与保持登录的三种模式 模式1：Cookie + Session（传统模式） 暂时无法在南开飞书文档外展示此内容 具体流程： 用户输入用户名密码提交登录 服务器验证通过，创建Session并存储用户信息 服务器响应：Set-Cookie: JSESSIONID=abc123; HttpOnly 浏览器存储Cookie 后续请求自动携带：Coo..."}],["meta",{"property":"og:type","content":"website"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-02-14T18:22:20.000Z"}],["meta",{"property":"article:tag","content":"身份验证"}],["meta",{"property":"article:tag","content":"登录"}],["meta",{"property":"article:published_time","content":"2026-02-15T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2026-02-14T18:22:20.000Z"}]]},"git":{"createdTime":1771093340000,"updatedTime":1771093340000,"contributors":[{"name":"dongjiwang","username":"dongjiwang","email":"1790921341@qq.com","commits":1,"url":"https://github.com/dongjiwang"}]},"readingTime":{"minutes":2.54,"words":762},"filePathRelative":"projects/dianping/01.登录.md","excerpt":"\\n<h2>模式1：Cookie + Session（传统模式）</h2>\\n<p>暂时无法在南开飞书文档外展示此内容</p>\\n<p>具体流程：</p>\\n<ol>\\n<li>用户输入用户名密码提交登录</li>\\n<li>服务器验证通过，创建Session并存储用户信息</li>\\n<li>服务器响应：<code>Set-Cookie: JSESSIONID=abc123; HttpOnly</code></li>\\n<li>浏览器存储Cookie</li>\\n<li>后续请求自动携带：<code>Cookie: JSESSIONID=abc123</code></li>\\n<li>服务器通过SessionID查找Session，验证用户身份</li>\\n</ol>","autoDesc":true}`);export{p as comp,d as data};
