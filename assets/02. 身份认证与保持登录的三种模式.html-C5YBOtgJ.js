import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as d,a as o,f as l,d as r,b as s,w as i,e as n,r as p,o as g}from"./app-D9h6flBx.js";const k={},c={start:"3"};function u(T,e){const t=p("font");return g(),d("div",null,[e[17]||(e[17]=o("h2",{id:"模式1-cookie-session-传统模式",tabindex:"-1"},[o("a",{class:"header-anchor",href:"#模式1-cookie-session-传统模式"},[o("span",null,"模式1：Cookie + Session（传统模式）")])],-1)),l(" 这是一张图片，ocr 内容为： "),e[18]||(e[18]=r('<figure><img src="https://jiwang.cc.cd/PicGo/1771394613274-343a0416-83db-4d87-8e3c-aca5377c4f5b.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>具体流程：</p><blockquote><ol><li>用户输入用户名密码提交登录</li><li>服务器验证通过，创建Session并存储用户信息</li><li>服务器响应：<code>Set-Cookie: JSESSIONID=abc123; HttpOnly</code></li><li>浏览器存储Cookie</li><li>后续请求自动携带：<code>Cookie: JSESSIONID=abc123</code></li><li>服务器通过SessionID查找Session，验证用户身份</li></ol></blockquote>',3)),s(t,{style:{color:"rgb(216,57,49)"}},{default:i(()=>[...e[0]||(e[0]=[n("其中JSESSIONID 是 Java Web 容器默认用于保存 SessionID 的 Cookie 名称，服务器通过它找到对应的 Session 对象，从而识别用户身份。",-1)])]),_:1}),e[19]||(e[19]=o("h2",{id:"模式2-token方案",tabindex:"-1"},[o("a",{class:"header-anchor",href:"#模式2-token方案"},[o("span",null,"模式2：Token方案")])],-1)),l(" 这是一张图片，ocr 内容为： "),e[20]||(e[20]=o("figure",null,[o("img",{src:"https://jiwang.cc.cd/PicGo/1771394640405-9e9b673d-146c-4399-87da-9b8c86f356b4.png",alt:"",tabindex:"0",loading:"lazy"}),o("figcaption")],-1)),e[21]||(e[21]=o("p",null,"Token流程细节（以JWT为例）：",-1)),o("blockquote",null,[e[5]||(e[5]=o("ol",null,[o("li",null,[o("p",null,"客户端提交认证信息")]),o("li",null,[o("p",null,"服务器验证成功后生成JWT："),o("p",null,"Header.Payload.Signature"),o("p",null,[o("code",null,'{"userId": "123","username": "john","exp": 1672531200, "iat": 1672527600// 签发时间}')])])],-1)),e[6]||(e[6]=o("p",null,"返回JWT给客户端",-1)),o("ol",c,[e[3]||(e[3]=o("li",null,"客户端存储JWT",-1)),o("li",null,[e[2]||(e[2]=n("客户端在后续请求中通过 HTTP Header 自动携带 JWT。",-1)),s(t,{style:{color:"rgb(216,57,49)"}},{default:i(()=>[...e[1]||(e[1]=[n("注意：这是HTTP Header，不是 JWT Header,别给自己绕晕了。",-1)])]),_:1})]),e[4]||(e[4]=o("li",null,"服务器验证 JWT 签名，若通过，则解析 Payload 获取用户身份信息，并进行具体的 HTTP 请求处理。",-1))])]),e[22]||(e[22]=o("h2",{id:"模式3-session-token混合",tabindex:"-1"},[o("a",{class:"header-anchor",href:"#模式3-session-token混合"},[o("span",null,"模式3：Session + Token混合")])],-1)),l(" 这是一张图片，ocr 内容为： "),e[23]||(e[23]=o("figure",null,[o("img",{src:"https://jiwang.cc.cd/PicGo/1771394652682-b544a1fc-fa6c-49f6-91ef-13161706d594.png",alt:"",tabindex:"0",loading:"lazy"}),o("figcaption")],-1)),e[24]||(e[24]=o("p",null,[n("在使用 "),o("strong",null,"JWT + Refresh Token"),n(" 的登录体系中，Refresh Token 的可选刷新机制有两个核心作用。")],-1)),o("p",null,[e[8]||(e[8]=n("首先，它可以保证用户",-1)),s(t,{style:{color:"rgb(216,57,49)"}},{default:i(()=>[...e[7]||(e[7]=[n("长期无缝登录",-1)])]),_:1}),e[9]||(e[9]=n("。Access Token 的有效期通常比较短，用于接口访问。当 Access Token 过期时，客户端可以使用 Refresh Token 获取新的 Access Token，从而无需用户重新登录。通过可选刷新机制，服务器可以延长 Refresh Token 的有效期，让用户在不频繁输入密码的情况下持续使用系统。",-1))]),o("p",null,[e[11]||(e[11]=n("其次，可选刷新机制可以",-1)),s(t,{style:{color:"#DF2A3F"}},{default:i(()=>[...e[10]||(e[10]=[n("提升安全性",-1)])]),_:1}),e[12]||(e[12]=n("，防止 Token 被滥用。Refresh Token 如果一直不变，一旦被盗用，攻击者就可能不断刷新 Access Token，长期访问系统。为了降低这种风险，当 Refresh Token 快过期时（比如剩余有效期不到三天），服务器会生成一个新的 Refresh Token，并让旧的失效。这样既保证了长期登录体验，又避免了长时间有效的 Token 被滥用。",-1))]),e[25]||(e[25]=o("p",null,[n("总的来说，可选刷新 Refresh Token 是在 "),o("strong",null,"用户体验与安全性之间的一种平衡"),n("。它只在必要时触发刷新，让用户无需频繁登录，同时保护系统安全。")],-1)),o("p",null,[e[15]||(e[15]=n("值得注意的是，",-1)),s(t,{style:{color:"rgb(216,57,49)"}},{default:i(()=>[...e[13]||(e[13]=[n("刷新操作 ",-1)])]),_:1}),o("strong",null,[s(t,{style:{color:"rgb(216,57,49)"}},{default:i(()=>[...e[14]||(e[14]=[n("必须依赖用户的实际请求",-1)])]),_:1})]),e[16]||(e[16]=n("，否则任何 Token 都会自然过期。比如如果我登陆了一个网站再refresh token的有效期内都没有进行任何操作，那就得重新登录了。",-1))]),e[26]||(e[26]=r('<h2 id="小结" tabindex="-1"><a class="header-anchor" href="#小结"><span>小结</span></a></h2><p><strong>传统 Session vs Token-Session (现代无状态 Session)：</strong></p><ul><li><strong>传统 Session</strong>：客户端只持有一个 SessionID，服务器存储所有用户数据（如 <code>userId</code>、<code>name</code>、<code>permissions</code> 等）。</li><li><strong>Token-Session</strong>：客户端持有完整的 Token（包含用户身份信息），服务器不存储用户身份信息，只验证 Token 的签名。</li></ul><h4 id="_1-token-验证流程" tabindex="-1"><a class="header-anchor" href="#_1-token-验证流程"><span>1. <strong>Token 验证流程</strong></span></a></h4><ul><li><strong>Access Token 验证</strong>：服务器只验证 Token 的签名和过期时间，不查询数据库，除非使用了黑名单机制。</li><li><strong>Refresh Token 刷新</strong>：只有在 Access Token 过期或验证失败时，客户端才使用 Refresh Token 进行数据库查询以获取新的 Access Token。</li></ul><h4 id="_2-刷新逻辑" tabindex="-1"><a class="header-anchor" href="#_2-刷新逻辑"><span>2. <strong>刷新逻辑</strong></span></a></h4><ul><li><strong>返回错误而非延长 Token</strong>：服务器不会主动延长 Access Token 的有效期。若 Token 过期，服务器返回 <code>401</code> 错误，提示客户端使用 Refresh Token 刷新 Access Token（两次请求互相独立）。</li><li><strong>控制 Refresh Token 使用频率和撤销</strong>：从无状态的脱缰野马 到 有状态的安全可控。</li></ul><h4 id="_3-refresh-token-刷新流程" tabindex="-1"><a class="header-anchor" href="#_3-refresh-token-刷新流程"><span>3. <strong>Refresh Token 刷新流程</strong></span></a></h4><ul><li><strong>客户端带 Refresh Token 请求刷新</strong>：通过 HttpOnly Cookie 自动携带 Refresh Token。</li><li><strong>服务器验证流程</strong>： <ul><li>计算 Token 哈希，查数据库或 Redis 对比存储记录。</li><li>检查 Token 是否被撤销（<code>revoked: true</code>）。</li><li>对比 Token 的过期时间（<code>expiresAt</code>）。</li><li>可选：检查刷新频率等。</li></ul></li><li><strong>验证通过后</strong>：服务器生成新的 Access Token 并可选择更新 Refresh Token（Token 轮换），同时更新最后使用时间。</li><li><strong>返回结果</strong>：返回新的 Access Token 或错误信息。</li></ul><h4 id="_4-安全设计原则" tabindex="-1"><a class="header-anchor" href="#_4-安全设计原则"><span>4. <strong>安全设计原则</strong></span></a></h4><ul><li><strong>Refresh Token 的严格验证</strong>：由于 Refresh Token 是长期凭证，必须对其进行严格管理和撤销控制。服务器存储的过期时间（<code>expiresAt</code>）是权威的，客户端 Cookie 的过期时间仅供参考。即便客户端 Cookie 仍有效，如果服务器端记录已过期或撤销，刷新请求将被拒绝。</li></ul>',11))])}const m=a(k,[["render",u]]),b=JSON.parse(`{"path":"/projects/dianping/02.%20%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E4%B8%8E%E4%BF%9D%E6%8C%81%E7%99%BB%E5%BD%95%E7%9A%84%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F.html","title":"02. 身份认证与保持登录的三种模式","lang":"en-US","frontmatter":{"title":"02. 身份认证与保持登录的三种模式","article":false,"category":["项目","《优享生活圈》"],"tag":["session","JWT"],"date":"2026-02-15T00:00:00.000Z","description":"模式1：Cookie + Session（传统模式） 具体流程： 用户输入用户名密码提交登录 服务器验证通过，创建Session并存储用户信息 服务器响应：Set-Cookie: JSESSIONID=abc123; HttpOnly 浏览器存储Cookie 后续请求自动携带：Cookie: JSESSIONID=abc123 服务器通过Session...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"WebPage\\",\\"name\\":\\"02. 身份认证与保持登录的三种模式\\",\\"description\\":\\"模式1：Cookie + Session（传统模式） 具体流程： 用户输入用户名密码提交登录 服务器验证通过，创建Session并存储用户信息 服务器响应：Set-Cookie: JSESSIONID=abc123; HttpOnly 浏览器存储Cookie 后续请求自动携带：Cookie: JSESSIONID=abc123 服务器通过Session...\\"}"],["meta",{"property":"og:url","content":"https://jiwang.online/projects/dianping/02.%20%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E4%B8%8E%E4%BF%9D%E6%8C%81%E7%99%BB%E5%BD%95%E7%9A%84%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F.html"}],["meta",{"property":"og:site_name","content":"jiwang's blog"}],["meta",{"property":"og:title","content":"02. 身份认证与保持登录的三种模式"}],["meta",{"property":"og:description","content":"模式1：Cookie + Session（传统模式） 具体流程： 用户输入用户名密码提交登录 服务器验证通过，创建Session并存储用户信息 服务器响应：Set-Cookie: JSESSIONID=abc123; HttpOnly 浏览器存储Cookie 后续请求自动携带：Cookie: JSESSIONID=abc123 服务器通过Session..."}],["meta",{"property":"og:type","content":"website"}],["meta",{"property":"og:image","content":"https://jiwang.cc.cd/PicGo/1771394613274-343a0416-83db-4d87-8e3c-aca5377c4f5b.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2026-02-18T14:36:35.000Z"}],["meta",{"property":"article:tag","content":"JWT"}],["meta",{"property":"article:tag","content":"session"}],["meta",{"property":"article:published_time","content":"2026-02-15T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2026-02-18T14:36:35.000Z"}]]},"git":{"createdTime":1771425395000,"updatedTime":1771425395000,"contributors":[{"name":"dongjiwang","username":"dongjiwang","email":"1790921341@qq.com","commits":1,"url":"https://github.com/dongjiwang"}]},"readingTime":{"minutes":4.19,"words":1258},"filePathRelative":"projects/dianping/02. 身份认证与保持登录的三种模式.md","excerpt":"<h2>模式1：Cookie + Session（传统模式）</h2>\\n<!-- 这是一张图片，ocr 内容为： -->\\n<figure><img src=\\"https://jiwang.cc.cd/PicGo/1771394613274-343a0416-83db-4d87-8e3c-aca5377c4f5b.png\\" alt=\\"\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption></figcaption></figure>\\n<p>具体流程：</p>\\n<blockquote>\\n<ol>\\n<li>用户输入用户名密码提交登录</li>\\n<li>服务器验证通过，创建Session并存储用户信息</li>\\n<li>服务器响应：<code>Set-Cookie: JSESSIONID=abc123; HttpOnly</code></li>\\n<li>浏览器存储Cookie</li>\\n<li>后续请求自动携带：<code>Cookie: JSESSIONID=abc123</code></li>\\n<li>服务器通过SessionID查找Session，验证用户身份</li>\\n</ol>\\n</blockquote>","autoDesc":true}`);export{m as comp,b as data};
